# 쿠키와 세션

## 쿠키와 세션을 사용하는 이유

HTTP는 필요할 때마다 요청을 보내고 응답을 받는 비연결성이다.

- 요청과 응답이 끝나면 서버는 접속을 끊는데, 이는 상태 정보가 유지되지 않는다는 것이다. (stateless)

상태 정보를 유지하기 위한 방법으로 쿠키와 세션을 사용할 수 있다.

- 예를 들어 쿠키와 세션을 사용하지 않고 로그인 하면, 다른 도메인으로 이동했다가 기존 사이트로 돌아오면 로그인 정보가 유지되지 않는다.

- 이때 쿠키와 세션을 활용하여 로그인을 유지할 수 있다.

## 쿠키

사용자가 웹 사이트를 방문하면, 그 사이트의 서버에서 사용자의 컴퓨터에 저장하는 작은 기록 정보 파일이다.

클라이언트의 상태 정보를 클라이언트에 쿠키 형태로 저장하여 필요 시 정보를 참조하거나 재사용할 수 있다.

- 쿠키의 특징

  - 이름, 값, 만료일, 경로 정보 등으로 구성되어 있다.

  - 클라이언트에 총 300개의 쿠키를 저장할 수 있다.

  - 하나의 도메인 당 20개의 쿠키를 가질 수 있다.

  - 하나의 쿠키는 4KB(=4096Byte)까지 저장할 수 있다.

- 쿠키의 동작

  1. 클라이언트가 웹 사이트에 접근하여 페이지를 요청하면 서버는 쿠키를 생성한다.

  2. 서버가 요청에 응답할 때 생성된 쿠키에 정보를 담아 클라이언트에게 넘겨준다.

  3. 넘겨준 쿠키는 클라이언트가 보관하고 서버에 다시 요청할 때 쿠키를 함께 전송한다.

  4. 동일 사이트 재방문시 클라이언트가 쿠키를 갖고 있을 경우 요청과 함께 쿠키를 전송한다.

- 쿠키의 약점

  - 쿠키는 클라이언트(브라우저)에 저장된다.

    - 이는 보안에 취약하다.

    - 쿠키를 중간에 가로채면 유저의 정보를 얻을 수 있다.

    - 따라서 중요한 정보는 쿠키에 저장하지 않고 session id를 암호화하여 저장한다.

## 세션

사용자가 브라우저를 닫아 서버와의 연결을 끝내는 시점까지를 세션이라 한다.

서버에 세션에 대한 정보(세션 상태, 클라이언트 상태, 세션 데이터 등)를 저장하고 세션 쿠키를 클라이언트에게 주어 서버가 클라이언트를 식별할 수 있도록 하는 방식을 의미한다.

- 세션의 특징

  - 정해진 크기의 제한이 없다. (서버에 의존한다.)

  - 서버에서 세션 객체를 생성하여 각 클라이언트마다 고유한 세션 ID 값을 부여한다.

  - 쿠키를 사용하여 세션 ID 값을 클라이언트에 보낸다.

  - 브라우저가 종료되면 세션 쿠키가 삭제된다.

- 세션의 동작

  1. 클라이언트가 페이지를 요청한다.

  2. 서버는 클라이언트마다 고유의 세션 ID를 부여하고 쿠키에 담아 응답과 함께 보낸다.

  3. 클라이언트가 요청할 때 쿠키를 서버에 전달하는 것으로 세션 ID를 보낸다.

  4. 서버는 받은 세션 ID로 클라이언트 정보를 확인한다.

## 쿠키와 세션의 차이

- 저장 위치

  - 쿠키: 클라이언트(브라우저)에 파일로 저장되어 있다.

  - 세션: 서버에 저장되어있다.

- 보안

  - 쿠키: 클라이언트(브라우저)에 저장되기 때문에 중간에 가로챌 수 있어 보안에 취약하다.

  - 세션: 쿠키에 세션 ID만을 저장하고 서버에서 세션 ID로 구분해 활용하기 때문에 비교적 안전하다.

- 라이프 사이클

  - 쿠키: 파일로 저장되기 때문에 브라우저를 종료해도 지정한 만료기간에 따라 정보가 남아있다.

  - 세션: 브라우저가 종료되면 지정한 만료기간에 상관없이 삭제된다.

- 속도

  - 쿠키: 쿠키에 실제 정보가 담겨있기 때문에 비교적 빠르다.

  - 세션: 세션ID를 받아 서버에서 처리하므로 비교적 느리다.
